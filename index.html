<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Kesenian JPNT</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* --- CSS SAMA MACAM SEBELUM NI (TEMA CYBER TEAL) --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        body { font-family: 'Poppins', sans-serif; margin: 0; padding: 0; background-color: #f0f8f8; color: #333; scroll-behavior: smooth; }
        
        /* Header & Nav */
        header { background: linear-gradient(135deg, #002b2b 0%, #004d4d 100%); color: white; padding: 40px 20px; text-align: center; position: relative; overflow: hidden; }
        header h1 { margin: 0; font-size: 32px; text-transform: uppercase; background: linear-gradient(90deg, #e0f7fa, #00e5ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 30px rgba(0, 229, 255, 0.4); }
        .navbar { background-color: #003333; display: flex; justify-content: center; flex-wrap: wrap; position: sticky; top: 0; z-index: 1000; border-bottom: 3px solid #004d4d; }
        .nav-item { color: #e0f2f1; padding: 18px 22px; cursor: pointer; border: none; background: none; font-weight: 600; transition: 0.3s; font-family: 'Poppins'; }
        .nav-item:hover { color: #00e5ff; }

        /* Container & Cards */
        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; animation: fadeIn 0.8s ease-out; }
        .page-section { display: none; }
        .page-section.active { display: block; }
        .card { background: white; padding: 25px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 1px solid #e8e8e8; }
        
        /* Grid System */
        .grid-split { display: flex; gap: 30px; flex-wrap: wrap; }
        .col-left { flex: 7; min-width: 300px; }
        .col-right { flex: 3; min-width: 280px; }

        /* Stats Box Design */
        .stats-counter-box { background: #e0f7fa; padding:20px; text-align:center; border-radius:8px; color:#006064; border: 1px solid #b2ebf2; }
        .stats-number { font-size: 36px; font-weight: bold; color: #00838f; }

        /* Buttons */
        .btn-download { display: block; width: 100%; padding: 15px; margin-top: 10px; background: linear-gradient(45deg, #00897b, #00e5ff); color: white; text-align: center; text-decoration: none; font-weight: 700; border-radius: 50px; box-sizing: border-box; }

        /* Responsive */
        @media (max-width: 768px) { .grid-split { flex-direction: column; } .navbar { flex-direction: column; } }
    </style>
</head>
<body>

    <header>
        <h1>DASHBOARD KESENIAN JPNT</h1>
        <p>UNIT PEMBANGUNAN BAKAT MURID (KESENIAN)</p>
    </header>

    <div class="navbar">
        <button class="nav-item" onclick="bukaPage('home')">UTAMA</button>
        <button class="nav-item" onclick="bukaPage('fasus')">FASUS</button>
        <button class="nav-item" style="color:#00e5ff;" onclick="bukaPage('home'); document.getElementById('analisa').scrollIntoView();">ANALISA DATA</button>
    </div>

    <div class="container">

        <div id="home" class="page-section active">
            <div class="card" style="text-align: center; background: #e0f2f1;">
                <h2>üèÜ Analisa Keseluruhan</h2>
                <p>Data diambil terus dari pengkalan data Google Sheet.</p>
                
                <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                    <div style="flex:1; background:white; padding:20px; border-radius:10px;">
                        <h3>Total Penyertaan</h3>
                        <p id="grandTotal" style="font-size:50px; font-weight:800; color:#004d4d; margin:0;">Loading...</p>
                    </div>
                </div>

                <div style="margin-top: 30px; max-width: 600px; margin-left: auto; margin-right: auto;">
                    <canvas id="grafKeseluruhan"></canvas> </div>
            </div>
        </div>

        <div id="fasus" class="page-section">
            <h2 style="border-left: 5px solid #00e5ff; padding-left: 15px; color:#004d4d;">üéµ FASUS: Simfoni & Puisi Lagu</h2>
            
            <div class="grid-split">
                <div class="col-left card">
                    <h3>üìù Borang Pendaftaran</h3>
                    <iframe id="frame_fasus" src="" width="100%" height="800" frameborder="0"></iframe>
                </div>

                <div class="col-right">
                    <div class="card">
                        <h3>üìÇ Muat Turun</h3>
                        <a id="btn_konsep_fasus" href="#" class="btn-download">üì• KERTAS KONSEP</a>
                    </div>

                    <div class="card">
                        <h3>üìä Live Penyertaan</h3>
                        <div class="stats-counter-box">
                            <span id="count_fasus" class="stats-number">0</span><br>
                            <span style="font-size:12px;">SEKOLAH BERDAFTAR</span>
                        </div>
                        <p style="font-size:12px; color:#666; margin-top:10px;">*Data dikemaskini setiap kali page dibuka.</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // =================================================================
        // 1. RUANG CONFIG (CIKGU EDIT SINI JE UNTUK TAHUN DEPAN)
        // =================================================================
        
        const DATABASE = {
            "FASUS": {
                // Link Google Form (Viewform)
                form: "https://docs.google.com/forms/d/e/1FAIpQLSdc.../viewform?embedded=true", 
                
                // Link Download
                download: "https://drive.google.com/...", 
                
                // Link CSV dari Google Sheet (Publish to Web > CSV)
                // PASTIKAN COLUMN A IALAH NAMA PERTANDINGAN/DAERAH UTK GRAF
                sheetCsv: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ.../pub?output=csv" 
            }
        };

        // =================================================================
        // 2. FUNGSI UPDATE DATA AUTOMATIK (JANGAN UBAH BAWAH NI)
        // =================================================================

        // Setup awal bila website loading
        window.onload = function() {
            // Masukkan link ke dalam HTML
            document.getElementById('frame_fasus').src = DATABASE.FASUS.form;
            document.getElementById('btn_konsep_fasus').href = DATABASE.FASUS.download;
            
            // Tarik Data Statistik
            kiraStatistik(DATABASE.FASUS.sheetCsv, 'count_fasus');
        };

        function bukaPage(pageName) {
            document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
            document.getElementById(pageName).classList.add('active');
        }

        // FUNGSI POWER: Tarik CSV & Buat Graf
        function kiraStatistik(csvUrl, elementId) {
            fetch(csvUrl)
            .then(response => response.text())
            .then(data => {
                const rows = data.split('\n');
                const total = rows.length - 1; // Tolak 1 (Header)
                
                // 1. Update Nombor Teks
                document.getElementById(elementId).innerText = total;
                document.getElementById('grandTotal').innerText = total; // Contoh total semua

                // 2. Proses Data untuk Graf (Kira ikut Column B contohnya: Daerah)
                let statistikDaerah = {};
                rows.forEach((row, index) => {
                    if (index === 0) return; // Skip header
                    const cols = row.split(','); // Pecahkan ikut koma
                    const daerah = cols[1] ? cols[1].trim() : "Lain-lain"; // Ambil column ke-2
                    
                    if (statistikDaerah[daerah]) {
                        statistikDaerah[daerah]++;
                    } else {
                        statistikDaerah[daerah] = 1;
                    }
                });

                // 3. Lukis Graf (Pie Chart)
                lukisGraf(statistikDaerah);
            })
            .catch(err => console.log("Gagal tarik data:", err));
        }

        function lukisGraf(dataObj) {
            const ctx = document.getElementById('grafKeseluruhan').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut', // Jenis Graf: pie, bar, line, doughnut
                data: {
                    labels: Object.keys(dataObj),
                    datasets: [{
                        label: 'Jumlah Sekolah',
                        data: Object.values(dataObj),
                        backgroundColor: [
                            '#00e5ff', '#00b8d4', '#00838f', '#006064', '#80deea', '#b2ebf2'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }
    </script>

</body>
</html>
